{% extends "admin/base.html" %}

{% block admin_title %}Novo Jogador{% endblock %}

{% block admin_content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="fas fa-user-plus"></i> Novo Jogador
                </h5>
            </div>
            <div class="card-body">
                <!-- Preview da Foto -->
                <div class="text-center mb-4">
                    <div class="mb-3">
                        <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center mx-auto" 
                             style="width: 150px; height: 150px;">
                            <i class="fas fa-user text-white fa-4x"></i>
                        </div>
                        <p class="text-muted mt-2">Nenhuma foto definida</p>
                    </div>
                    
                    <!-- Upload de Foto -->
                    <div class="mt-3">
                        <label class="form-label">Foto do Jogador (Opcional)</label>
                        <div class="input-group">
                            <input type="file" class="form-control" id="foto" name="foto" 
                                   accept="image/*" onchange="previewFoto(event)">
                            <button type="button" class="btn btn-outline-secondary" onclick="document.getElementById('foto').click()">
                                <i class="fas fa-upload"></i> Escolher
                            </button>
                        </div>
                        <div class="form-text">Formatos: JPG, PNG, GIF. Máximo: 2MB</div>
                    </div>
                </div>
                
                <form method="POST" action="{{ url_for('novo_jogador') }}" id="formNovoJogador" enctype="multipart/form-data">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="nome" class="form-label">Nome Completo *</label>
                            <input type="text" class="form-control" id="nome" name="nome" required>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="apelido" class="form-label">Apelido</label>
                            <input type="text" class="form-control" id="apelido" name="apelido">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="telefone" class="form-label">Telefone</label>
                            <input type="tel" class="form-control" id="telefone" name="telefone" 
                                   placeholder="(11) 99999-9999">
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="cidade" class="form-label">Cidade</label>
                            <input type="text" class="form-control" id="cidade" name="cidade">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="data_nascimento" class="form-label">Data de Nascimento</label>
                            <input type="date" class="form-control" id="data_nascimento" name="data_nascimento">
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="altura" class="form-label">Altura</label>
                            <input type="text" class="form-control" id="altura" name="altura" 
                                   placeholder="Ex: 1.85m">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="posicao" class="form-label">Posição Principal</label>
                            <select class="form-select" id="posicao" name="posicao">
                                <option value="">Selecione...</option>
                                <option value="levantador">Levantador</option>
                                <option value="ponteiro">Ponteiro</option>
                                <option value="central">Central</option>
                                <option value="libero">Líbero</option>
                                <option value="oposto">Oposto</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="nivel" class="form-label">Nível *</label>
                            <select class="form-select" id="nivel" name="nivel" required>
                                <option value="iniciante">Iniciante</option>
                                <option value="intermediario" selected>Intermediário</option>
                                <option value="avancado">Avançado</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="mensalista" name="mensalista">
                                <label class="form-check-label" for="mensalista">
                                    <i class="fas fa-star text-warning"></i> Mensalista
                                </label>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="capitao" name="capitao">
                                <label class="form-check-label" for="capitao">
                                    <i class="fas fa-crown text-warning"></i> Capitão
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row" id="ordemCapitaoContainer" style="display: none;">
                        <div class="col-md-6 mb-3">
                            <label for="ordem_capitao" class="form-label">Ordem do Capitão</label>
                            <select class="form-select" id="ordem_capitao" name="ordem_capitao">
                                {% for i in range(1, 7) %}
                                <option value="{{ i }}" {% if i == 1 %}selected{% endif %}>
                                    {{ i }}º - {{ i }}º a escolher
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="criar_usuario" name="criar_usuario">
                                <label class="form-check-label" for="criar_usuario">
                                    <i class="fas fa-user-plus"></i> Criar conta de usuário
                                </label>
                                <div class="form-text">Recomendado para capitães</div>
                            </div>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('admin_jogadores') }}" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Cancelar
                        </a>
                        <button type="submit" class="btn btn-primary" id="btnSalvar">
                            <i class="fas fa-save"></i> Salvar Jogador
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="alert alert-info mt-3">
            <h6><i class="fas fa-info-circle"></i> Informações:</h6>
            <ul class="mb-0">
                <li>Os campos marcados com * são obrigatórios</li>
                <li>Capitães devem ter conta de usuário para acessar o painel</li>
                <li>Mensalistas são adicionados automaticamente à lista de espera se não confirmarem</li>
                <li>A ordem do capitão define a sequência de escolha no draft</li>
            </ul>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const capitaoCheckbox = document.getElementById('capitao');
    const ordemContainer = document.getElementById('ordemCapitaoContainer');
    const criarUsuarioCheckbox = document.getElementById('criar_usuario');
    
    capitaoCheckbox.addEventListener('change', function() {
        if (this.checked) {
            ordemContainer.style.display = 'block';
            criarUsuarioCheckbox.checked = true;
            criarUsuarioCheckbox.disabled = true;
        } else {
            ordemContainer.style.display = 'none';
            criarUsuarioCheckbox.disabled = false;
        }
    });
    
    // IMPORTANTE: Configurar o formulário para multipart/form-data
    const form = document.getElementById('formNovoJogador');
    if (!form.hasAttribute('enctype')) {
        form.setAttribute('enctype', 'multipart/form-data');
    }
});

function previewFoto(event) {
    const file = event.target.files[0];
    if (file) {
        if (file.size > 2 * 1024 * 1024) {
            alert('Arquivo muito grande! Máximo 2MB.');
            event.target.value = '';
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.querySelector('.rounded-circle.bg-secondary');
            if (preview) {
                preview.innerHTML = '';
                const img = document.createElement('img');
                img.src = e.target.result;
                img.style.width = '100%';
                img.style.height = '100%';
                img.style.objectFit = 'cover';
                img.style.borderRadius = '50%';
                preview.appendChild(img);
            }
        }
        reader.readAsDataURL(file);
    }
}
</script>
{% endblock %}